data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
# Des1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
stargazer(mydata, type = "html", title="Descriptive statistics", digits=5, out="des1.html",summary.stat = c("mean","median","sd","min","max","p25","p75","n"))
#Des2
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2.html")
#Des2.1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM")]
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2_1.html")
#Des3
mydata<-data[,c("RPA","ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
# Initialize a list to store results
variables<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
results <- list()
# Loop through each variable to calculate stats and perform tests
for (var in variables) {
# Separate the groups
group_rpa <- filter(mydata, RPA == 1) %>% pull(!!sym(var))
group_non_rpa <- filter(mydata, RPA == 0) %>% pull(!!sym(var))
# Calculate statistics
mean_rpa <- mean(group_rpa, na.rm = TRUE)
median_rpa <- median(group_rpa, na.rm = TRUE)
sd_rpa <- sd(group_rpa, na.rm = TRUE)
mean_non_rpa <- mean(group_non_rpa, na.rm = TRUE)
median_non_rpa <- median(group_non_rpa, na.rm = TRUE)
sd_non_rpa <- sd(group_non_rpa, na.rm = TRUE)
# Wilcoxon test
test_result <- wilcox_test(reformulate('RPA', response = var), data = mydata)
p_value <- pvalue(test_result)
# Store results
results[[var]] <- c(mean_rpa, median_rpa, sd_rpa, mean_non_rpa, median_non_rpa, sd_non_rpa, p_value)
}
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
library(stargazer)
library(corrtable)
library(coin)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
# Des1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
stargazer(mydata, type = "html", title="Descriptive statistics", digits=5, out="des1.html",summary.stat = c("mean","median","sd","min","max","p25","p75","n"))
#Des2
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2.html")
#Des2.1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM")]
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2_1.html")
#Des3
mydata<-data[,c("RPA","ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
# Initialize a list to store results
variables<-c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")
results <- list()
# Loop through each variable to calculate stats and perform tests
for (var in variables) {
# Separate the groups
group_rpa <- filter(mydata, RPA == 1) %>% pull(!!sym(var))
group_non_rpa <- filter(mydata, RPA == 0) %>% pull(!!sym(var))
# Calculate statistics
mean_rpa <- mean(group_rpa, na.rm = TRUE)
median_rpa <- median(group_rpa, na.rm = TRUE)
sd_rpa <- sd(group_rpa, na.rm = TRUE)
mean_non_rpa <- mean(group_non_rpa, na.rm = TRUE)
median_non_rpa <- median(group_non_rpa, na.rm = TRUE)
sd_non_rpa <- sd(group_non_rpa, na.rm = TRUE)
# Wilcoxon test
test_result <- wilcox_test(reformulate('RPA', response = var), data = mydata)
p_value <- pvalue(test_result)
# Store results
results[[var]] <- c(mean_rpa, median_rpa, sd_rpa, mean_non_rpa, median_non_rpa, sd_non_rpa, p_value)
}
# Convert results to a dataframe for easier manipulation and display
results_df <- do.call(rbind, results)
colnames(results_df) <- c("Mean RPA", "Median RPA", "SD RPA", "Mean Non-RPA", "Median Non-RPA", "SD Non-RPA", "P-Value")
rownames(results_df) <- variables
# Convert the results dataframe to a matrix for stargazer
results_matrix <- as.matrix(results_df)
# Use stargazer to create a table
stargazer(results_matrix, type = "html",out="des3.html",digits = 4, title = "Comparative Statistics: RPA vs. Non-RPA Firms", summary = FALSE)
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
library(stargazer)
library(corrtable)
library(coin)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
# Des1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
stargazer(mydata, type = "html", title="Descriptive statistics", digits=5, out="des1.html",summary.stat = c("mean","median","sd","min","max","p25","p75","n"))
#Des2
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2.html")
#Des2.1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM")]
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2_1.html")
#Des3
mydata<-data[,c("RPA_Ctd","ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
# Initialize a list to store results
variables<-c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")
results <- list()
# Loop through each variable to calculate stats and perform tests
for (var in variables) {
# Separate the groups
group_rpa <- filter(mydata, RPA_Ctd == 1) %>% pull(!!sym(var))
group_non_rpa <- filter(mydata, RPA_Ctd == 0) %>% pull(!!sym(var))
# Calculate statistics
mean_rpa <- mean(group_rpa, na.rm = TRUE)
median_rpa <- median(group_rpa, na.rm = TRUE)
sd_rpa <- sd(group_rpa, na.rm = TRUE)
mean_non_rpa <- mean(group_non_rpa, na.rm = TRUE)
median_non_rpa <- median(group_non_rpa, na.rm = TRUE)
sd_non_rpa <- sd(group_non_rpa, na.rm = TRUE)
# Wilcoxon test
test_result <- wilcox_test(reformulate('RPA', response = var), data = mydata)
p_value <- pvalue(test_result)
# Store results
results[[var]] <- c(mean_rpa, median_rpa, sd_rpa, mean_non_rpa, median_non_rpa, sd_non_rpa, p_value)
}
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
library(stargazer)
library(corrtable)
library(coin)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
# Des1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
stargazer(mydata, type = "html", title="Descriptive statistics", digits=5, out="des1.html",summary.stat = c("mean","median","sd","min","max","p25","p75","n"))
#Des2
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2.html")
#Des2.1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM")]
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2_1.html")
#Des3
mydata<-data[,c("RPA_Ctd","ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
# Initialize a list to store results
variables<-c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")
results <- list()
# Loop through each variable to calculate stats and perform tests
for (var in variables) {
# Separate the groups
group_rpa <- filter(mydata, RPA_Ctd == 1) %>% pull(!!sym(var))
group_non_rpa <- filter(mydata, RPA_Ctd == 0) %>% pull(!!sym(var))
# Calculate statistics
mean_rpa <- mean(group_rpa, na.rm = TRUE)
median_rpa <- median(group_rpa, na.rm = TRUE)
sd_rpa <- sd(group_rpa, na.rm = TRUE)
mean_non_rpa <- mean(group_non_rpa, na.rm = TRUE)
median_non_rpa <- median(group_non_rpa, na.rm = TRUE)
sd_non_rpa <- sd(group_non_rpa, na.rm = TRUE)
# Wilcoxon test
test_result <- wilcox_test(reformulate('RPA_Ctd', response = var), data = mydata)
p_value <- pvalue(test_result)
# Store results
results[[var]] <- c(mean_rpa, median_rpa, sd_rpa, mean_non_rpa, median_non_rpa, sd_non_rpa, p_value)
}
# Convert results to a dataframe for easier manipulation and display
results_df <- do.call(rbind, results)
colnames(results_df) <- c("Mean RPA", "Median RPA", "SD RPA", "Mean Non-RPA", "Median Non-RPA", "SD Non-RPA", "P-Value")
rownames(results_df) <- variables
# Convert the results dataframe to a matrix for stargazer
results_matrix <- as.matrix(results_df)
# Use stargazer to create a table
stargazer(results_matrix, type = "html",out="des3.html",digits = 4, title = "Comparative Statistics: RPA vs. Non-RPA Firms", summary = FALSE)
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
library(stargazer)
library(corrtable)
library(coin)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
# Des1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
stargazer(mydata, type = "html", title="Descriptive statistics", digits=5, out="des1.html",summary.stat = c("mean","median","sd","min","max","p25","p75","n"))
#Des2
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2.html")
#Des2.1
mydata<-data[,c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM")]
correlation.matrix <- correlation_matrix(mydata,type="spearman",use = "lower",show_significance = TRUE,digits = 3)
stargazer(correlation.matrix,type="html", title="Correlation Matrix",out="des2_1.html")
#Des3
mydata<-data[,c("RPA_Ctd","ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")]
# Initialize a list to store results
variables<-c("ABSDA2","DA2","ABCFO","ABPROD","ABEXP","RM","ADJROA","Age_Trade","RD","ADV","ESG","MTB","OCF","LEV","LGTA")
results <- list()
# Loop through each variable to calculate stats and perform tests
for (var in variables) {
# Separate the groups
group_rpa <- filter(mydata, RPA_Ctd == 1) %>% pull(!!sym(var))
group_non_rpa <- filter(mydata, RPA_Ctd == 0) %>% pull(!!sym(var))
# Calculate statistics
mean_rpa <- mean(group_rpa, na.rm = TRUE)
median_rpa <- median(group_rpa, na.rm = TRUE)
sd_rpa <- sd(group_rpa, na.rm = TRUE)
mean_non_rpa <- mean(group_non_rpa, na.rm = TRUE)
median_non_rpa <- median(group_non_rpa, na.rm = TRUE)
sd_non_rpa <- sd(group_non_rpa, na.rm = TRUE)
# Wilcoxon test
test_result <- wilcox_test(reformulate('RPA_Ctd', response = var), data = mydata)
p_value <- pvalue(test_result)
# Store results
results[[var]] <- c(mean_rpa, median_rpa, sd_rpa, mean_non_rpa, median_non_rpa, sd_non_rpa, p_value)
}
# Convert results to a dataframe for easier manipulation and display
results_df <- do.call(rbind, results)
colnames(results_df) <- c("Mean RPA", "Median RPA", "SD RPA", "Mean Non-RPA", "Median Non-RPA", "SD Non-RPA", "P-Value")
rownames(results_df) <- variables
# Convert the results dataframe to a matrix for stargazer
results_matrix <- as.matrix(results_df)
# Use stargazer to create a table
stargazer(results_matrix, type = "html",out="des3.html",digits = 4, title = "Comparative Statistics: RPA vs. Non-RPA Firms", summary = FALSE)
library(dplyr)
library(stargazer)
library(gdata)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("clean.csv")
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Assuming 'data' is your dataframe
data$Industry <- as.factor(data$Industry)
data$Year <- as.factor(data$Year)
# Initialize columns in 'data' for the abnormal measures
data$DA <- NA  # Discretionary Accruals for Jones model
data$DA1 <- NA
data$DA2 <- NA
data$DA3 <- NA
data$ABCFO <- NA  # Abnormal Cash Flow from Operations
data$ABPROD <- NA  # Abnormal Production Costs
data$ABEXP <- NA  # Abnormal Discretionary Expenses
#Jones/MJONES/MJONES_ROA/MJONES_BMCFO
data$AC<-(data$NI_Ctd-data$OCF)/data$Asset_1
data$A1<-1/data$Asset_1
data$A21<-(data$S-data$S_1)/data$Asset_1
data$A2<-(data$S-data$S_1-(data$AR-data$AR_1))/data$Asset_1
data$A3<-data$PPE/data$Asset_1
data$A4<-data$NI_Ctd/data$Asset_1
data$A5<-data$BM
data$A6<-data$OCF/data$Asset_1
data$ROA<-data$NI_Ctd/data$Asset_1
# Assuming your dataframe is named 'data' and it has columns 'ROA', 'Industry', and 'Year'
data <- data %>%
group_by(Industry, Year) %>%
mutate(
Median_ROA = median(ROA, na.rm = TRUE), # Calculate median of ROA for each Industry-Year group
ADJROA = ROA - Median_ROA # Subtract median ROA from ROA for each row
) %>%
ungroup() # Ungroup the data frame
data$CFO<-data$OCF/data$Asset_1
data$PROD<-data$PROD/data$Asset_1
data$EXP<-data$EXP/data$Asset_1
data$R1<-1/data$Asset_1
data$R2<-data$S/data$Asset_1
data$R3<-(data$S-data$S_1)/data$Asset_1
data$R4<-(data$S_1-data$S_2)/data$Asset_1
data$R5<-data$S_1/data$Asset_1
# Loop through each industry to perform calculations
unique_industries <- unique(data$Industry)
all_industries_data<-NULL
# Loop through each industry to perform calculations and save regression results
for(industry in unique_industries) {
# Subset data for the current industry
industry_data <- data %>% filter(Industry == industry)
# Perform your Jones model and Roychowdhury measures calculations here
jones_model <- lm(AC ~ A1 + A21 + A3, data = industry_data)
industry_data$DA <- residuals(jones_model)
jones_model1 <- lm(AC ~ A1 + A2 + A3, data = industry_data)
industry_data$DA1 <- residuals(jones_model1)
jones_model2 <- lm(AC ~ A1 + A2 + A3 + A4, data = industry_data)
industry_data$DA2 <- residuals(jones_model2)
jones_model3 <- lm(AC ~ A1 + A2 + A3 + A4 + A5 + A6, data = industry_data)
industry_data$DA3 <- residuals(jones_model3)
model_cfo <- lm(CFO ~ R1 + R2 + R3, data = industry_data)
industry_data$ABCFO <- residuals(model_cfo)
model_prod <- lm(PROD ~ R1 + R2 + R3 + R4, data = industry_data)
industry_data$ABPROD <- residuals(model_prod)
model_exp <- lm(EXP ~ R1 + R5, data = industry_data)
industry_data$ABEXP <- residuals(model_exp)
# Save regression results to text files
file_name <- paste0("Industry_", as.character(industry), "_Regression_Results.txt")
sink(file_name)
cat("Jones Model:\n")
print(summary(jones_model))
cat("\nJones Model 1:\n")
print(summary(jones_model1))
cat("\nJones Model 2:\n")
print(summary(jones_model2))
cat("\nJones Model 3:\n")
print(summary(jones_model3))
cat("\nCFO Model:\n")
print(summary(model_cfo))
cat("\nPROD Model:\n")
print(summary(model_prod))
cat("\nEXP Model:\n")
sink()
# Append the modified data frame to the all_industries_data dataframe
if(is.null(all_industries_data)) {
all_industries_data <- industry_data
} else {
all_industries_data <- rbind(all_industries_data, industry_data)
}
}
library(dplyr)
library(stargazer)
library(gdata)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("clean.csv")
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Assuming 'data' is your dataframe
data$Industry <- as.factor(data$Industry)
data$Year <- as.factor(data$Year)
# Initialize columns in 'data' for the abnormal measures
data$DA <- NA  # Discretionary Accruals for Jones model
data$DA1 <- NA
data$DA2 <- NA
data$DA3 <- NA
data$ABCFO <- NA  # Abnormal Cash Flow from Operations
data$ABPROD <- NA  # Abnormal Production Costs
data$ABEXP <- NA  # Abnormal Discretionary Expenses
#Jones/MJONES/MJONES_ROA/MJONES_BMCFO
data$AC<-(data$NI_Ctd-data$OCF)/data$Asset_1
data$A1<-1/data$Asset_1
data$A21<-(data$S-data$S_1)/data$Asset_1
data$A2<-(data$S-data$S_1-(data$AR-data$AR_1))/data$Asset_1
data$A3<-data$PPE/data$Asset_1
data$A4<-data$NI_Ctd/data$Asset_1
data$A5<-data$BM
data$A6<-data$OCF/data$Asset_1
data$ROA<-data$NI_Ctd/data$Asset_1
# Assuming your dataframe is named 'data' and it has columns 'ROA', 'Industry', and 'Year'
data <- data %>%
group_by(Industry, Year) %>%
mutate(
Median_ROA = median(ROA, na.rm = TRUE), # Calculate median of ROA for each Industry-Year group
ADJROA = ROA - Median_ROA # Subtract median ROA from ROA for each row
) %>%
ungroup() # Ungroup the data frame
data$CFO<-data$OCF/data$Asset_1
data$PROD<-data$PROD/data$Asset_1
data$EXP<-data$EXP/data$Asset_1
data$R1<-1/data$Asset_1
data$R2<-data$S/data$Asset_1
data$R3<-(data$S-data$S_1)/data$Asset_1
data$R4<-(data$S_1-data$S_2)/data$Asset_1
data$R5<-data$S_1/data$Asset_1
# Loop through each industry to perform calculations
unique_industries <- unique(data$Industry)
all_industries_data<-NULL
# Loop through each industry to perform calculations and save regression results
for(industry in unique_industries) {
# Subset data for the current industry
industry_data <- data %>% filter(Industry == industry)
# Perform your Jones model and Roychowdhury measures calculations here
jones_model <- lm(AC ~ A1 + A21 + A3, data = industry_data)
industry_data$DA <- residuals(jones_model)
jones_model1 <- lm(AC ~ A1 + A2 + A3, data = industry_data)
industry_data$DA1 <- residuals(jones_model1)
jones_model2 <- lm(AC ~ A1 + A2 + A3 + A4, data = industry_data)
industry_data$DA2 <- residuals(jones_model2)
jones_model3 <- lm(AC ~ A1 + A2 + A3 + A4 + A5 + A6, data = industry_data)
industry_data$DA3 <- residuals(jones_model3)
model_cfo <- lm(CFO ~ R1 + R2 + R3, data = industry_data)
industry_data$ABCFO <- residuals(model_cfo)
model_prod <- lm(PROD ~ R1 + R2 + R3 + R4, data = industry_data)
industry_data$ABPROD <- residuals(model_prod)
model_exp <- lm(EXP ~ R1 + R5, data = industry_data)
industry_data$ABEXP <- residuals(model_exp)
# Save regression results to text files
file_name <- paste0("Industry_", as.character(industry), "_Regression_Results.txt")
sink(file_name)
cat("Jones Model:\n")
print(summary(jones_model))
cat("\nJones Model 1:\n")
print(summary(jones_model1))
cat("\nJones Model 2:\n")
print(summary(jones_model2))
cat("\nJones Model 3:\n")
print(summary(jones_model3))
cat("\nCFO Model:\n")
print(summary(model_cfo))
cat("\nPROD Model:\n")
print(summary(model_prod))
cat("\nEXP Model:\n")
sink()
# Append the modified data frame to the all_industries_data dataframe
if(is.null(all_industries_data)) {
all_industries_data <- industry_data
} else {
all_industries_data <- rbind(all_industries_data, industry_data)
}
}
