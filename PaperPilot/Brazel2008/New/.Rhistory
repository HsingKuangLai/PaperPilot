###second step mataching
library(MatchIt)
## generate psm score by glm
ps_model <- glm(RPA ~ (ABSDA2 + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year, data = data)
data$propensity_score <- predict(ps_model)
# matching parameter method=nn, distance=glm, link=probit, caliper=NULL
matched_data<- matchit( RPA ~ (ABSDA2 + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year , data = data, link="probit", method = "nearest",distance = "glm")
data <- match.data(matched_data)
model <- (lm((ABSDA2) ~ RPA  + (RM + LEV + OCF + MTB  + ADJROA  + LGTA + Age_Trade + Big4 + RD + ADV + ESG) + Year + Trade , data = data))
summary(model)
coeftest(model, vcov = vcovHC(model))
coeftest(model, vcov = vcovCL(model,cluster = ~Key))
library(sandwich)
library(lmtest)
library(MASS)
library(Matching)
library(rgenoud)
library(MatchIt)
# read CSV
data <- read.csv("Total.csv", na.strings = "#N/A")
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
######fisrt step######################### winsorizing
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
data$RPA<-as.double(data$RPA)-1
###second step mataching
library(sandwich)
library(lmtest)
library(MASS)
library(Matching)
library(rgenoud)
library(MatchIt)
# read CSV
data <- read.csv("Total.csv", na.strings = "#N/A")
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
######fisrt step######################### winsorizing
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.05)  # 1st percentile value
p99 <- quantile(x, probs = 0.95)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
data$RPA<-as.double(data$RPA)-1
###second step mataching
library(MatchIt)
## generate psm score by glm
ps_model <- glm(RPA ~ (RM + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year, data = data)
data$propensity_score <- predict(ps_model)
# matching parameter method=nn, distance=glm, link=probit, caliper=NULL
matched_data<- matchit( RPA ~ (RM + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year , data = data, link="probit", method = "nearest",distance = "glm")
data <- match.data(matched_data)
model <- (lm((ABSDA2) ~ RPA  + (RM + LEV + OCF + MTB  + ADJROA  + LGTA + Age_Trade + Big4 + RD + ADV + ESG) + Year + Trade , data = data))
summary(model)
coeftest(model, vcov = vcovHC(model))
coeftest(model, vcov = vcovCL(model,cluster = ~Key))
library(sandwich)
library(lmtest)
library(MASS)
library(Matching)
library(rgenoud)
library(MatchIt)
# read CSV
data <- read.csv("Total.csv", na.strings = "#N/A")
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
######fisrt step######################### winsorizing
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.05)  # 1st percentile value
p99 <- quantile(x, probs = 0.95)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
data$RPA<-as.double(data$RPA)-1
###second step mataching
library(MatchIt)
## generate psm score by glm
ps_model <- glm(RPA ~ (ABSDA2 + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year, data = data)
data$propensity_score <- predict(ps_model)
# matching parameter method=nn, distance=glm, link=probit, caliper=NULL
matched_data<- matchit( RPA ~ (ABSDA2 + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year , data = data, link="probit", method = "nearest",distance = "glm")
data <- match.data(matched_data)
X_vars <- c("ABSDA2")
Y_vars <- c("RM", "RM1","ABCFO","ABEXP","ABPROD")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age_Trade + Big4 + RD + ADV + ESG + Year + Trade"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
library(sandwich)
library(lmtest)
library(MASS)
library(Matching)
library(rgenoud)
library(MatchIt)
# read CSV
data <- read.csv("Total.csv", na.strings = "#N/A")
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
######fisrt step######################### winsorizing
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.03)  # 1st percentile value
p99 <- quantile(x, probs = 0.97)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
data$RPA<-as.double(data$RPA)-1
###second step mataching
library(MatchIt)
## generate psm score by glm
ps_model <- glm(RPA ~ (ABSDA2 + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year, data = data)
data$propensity_score <- predict(ps_model)
# matching parameter method=nn, distance=glm, link=probit, caliper=NULL
matched_data<- matchit( RPA ~ (ABSDA2 + LEV + OCF + MTB  + ADJROA + LGTA + Age_Trade + RD + ADV + ESG + Big4 + GC + Trade) + Year , data = data, link="probit", method = "nearest",distance = "glm")
data <- match.data(matched_data)
X_vars <- c("ABSDA2")
Y_vars <- c("RM", "RM1","ABCFO","ABEXP","ABPROD")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age_Trade + Big4 + RD + ADV + ESG + Year + Trade"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
data$RM2<-data$ABPROD-data$ABEXP
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
# Define the different values for Y and X
X_vars <- c("ABSDA", "ABSDA1", "ABSDA2")
Y_vars <- c("RM", "RM1","RM2","ABCFO","ABEXP","ABPROD")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age_Trade + Big4 + RD + ADV + ESG + GC + Year"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
data$RM2<-data$ABPROD-data$ABEXP
data<-subset(data,data$DA2>0)
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
# Define the different values for Y and X
Y_vars <- c("ABSDA", "ABSDA1", "ABSDA2")
X_vars <- c("RM", "RM1","RM2")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age_Trade + Big4 + RD + ADV + ESG + GC + Year"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
data$RM2<-data$ABPROD-data$ABEXP
data<-subset(data,data$DA2>0)
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
#Now, perform the Huber regression or any regression analysis using winsorized variables+ Year + Industry
#AM
sink("AM_P.txt")
# Define the different values for Y and X
Y_vars <- c("DA2")
X_vars <- c("RM", "RM1")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age + Big4 + RD + ADV + ESG + GC + Year"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
sink()
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
data$RM2<-data$ABPROD-data$ABEXP
data<-subset(data,data$DA2<=0)
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
#Now, perform the Huber regression or any regression analysis using winsorized variables+ Year + Industry
#AM
sink("AM_N.txt")
# Define the different values for Y and X
Y_vars <- c("DA2")
X_vars <- c("RM", "RM1")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age + Big4 + RD + ADV + ESG + GC + Year"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
sink()
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
data$RM2<-data$ABPROD-data$ABEXP
data<-subset(data,data$DA2<=0)
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
#Now, perform the Huber regression or any regression analysis using winsorized variables+ Year + Industry
#AM
sink("AM__Trade_N.txt")
# Define the different values for Y and X
Y_vars <- c("DA2")
X_vars <- c("RM", "RM1")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age_Trade + Big4 + RD + ADV + ESG + GC + Year"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
sink()
library(sandwich)
library(lmtest)
library(MASS)
library(dplyr)
# 讀取 CSV 檔案，將 "#N/A" 轉換為真正的 NA（缺失值）
data <- read.csv("Total.csv")
# 移除含有缺失值的觀測值
data$ABSDA<-abs(data$DA)
data$ABSDA1<-abs(data$DA1)
data$ABSDA2<-abs(data$DA2)
data$ABSDA3<-abs(data$DA3)
data$RM<-data$ABCFO+data$ABEXP-data$ABPROD
data$RM1<-data$ABCFO+data$ABEXP
data$RM2<-data$ABPROD-data$ABEXP
data<-subset(data,data$DA2>=0)
########### winsorizing 1%
# Define a function for winsorizing
winsorize <- function(x) {
p1 <- quantile(x, probs = 0.01)  # 1st percentile value
p99 <- quantile(x, probs = 0.99)  # 99th percentile value
x[x < p1] <- p1  # Replace values below 1st percentile
x[x > p99] <- p99  # Replace values above 99th percentile
return(x)
}
# Factorize the first 6 columns
data[1:8] <- lapply(data[1:8], factor)
# Apply the winsorize function to the remaining columns
data <- data %>%
mutate(across(.cols = 9:ncol(data), .fns = ~winsorize(.)))
#Now, perform the Huber regression or any regression analysis using winsorized variables+ Year + Industry
#AM
sink("AM__Trade_P.txt")
# Define the different values for Y and X
Y_vars <- c("DA2")
X_vars <- c("RM", "RM1")
# Loop over each combination of Y and X
for (Y_var in Y_vars) {
for (X_var in X_vars) {
# Define the model formula
formula <- as.formula(paste0(Y_var, " ~ RPA + ", X_var,
" + LEV + OCF + MTB + ADJROA + LGTA + Age_Trade + Big4 + RD + ADV + ESG + GC + Year"))
# Fit the model
model <- lm(formula, data = data)
# Print summary
print(paste0("Model: ", Y_var, " ~ ", X_var))
print(summary(model))
# Perform coeftest with vcovHC
print(coeftest(model, vcov = vcovHC(model)))
# Perform coeftest with vcovCL
print(coeftest(model, vcov = vcovCL(model, cluster = ~Key)))
# Optionally, you can save the model results or coefficients into a list or data frame if needed
}
}
sink()
